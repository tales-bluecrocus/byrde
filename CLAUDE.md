# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Byrde is a WordPress theme with automatic GitHub-based updates. Built with Vite for modern JavaScript/CSS compilation, ACF for flexible page building, and a complete tracking infrastructure for marketing campaigns.

## Development Commands

### Asset Compilation
```bash
# Development mode (watch for changes)
npm run watch

# Production build
npm run build

# Clean build artifacts
npm run clean
```

### Code Quality
```bash
# Fix PHP code style (PHP-CS-Fixer)
composer run fix
```

The project uses `phpcs.xml` for WordPress coding standards and `.config/.php-cs-fixer.dist.php` for automated fixes.

### Release Management
```bash
# Create a new release (auto-increments version)
./.config/bump-version.sh patch    # Bug fixes: 1.0.0 → 1.0.1
./.config/bump-version.sh minor    # New features: 1.0.0 → 1.1.0
./.config/bump-version.sh major    # Breaking changes: 1.0.0 → 2.0.0

# First release
./.config/create-release.sh 1.0.0

# Manual ZIP creation (for testing)
./.config/build-zip.sh
```

GitHub Actions automatically compiles assets and creates distributable ZIPs on tagged releases. WordPress checks for updates via Plugin Update Checker.

## Code Guidelines

### English-Only Policy
All documentation, comments, code, logs, and project-related content must be written in English. This includes:
- Code comments (inline and block)
- Function and variable names
- Documentation files (README, guides, etc.)
- Commit messages
- Git branch names
- Console logs and error messages
- ACF field labels and instructions (when possible)

### No Emojis Policy
Never add emojis to any part of this project - not in code, logs, comments, documentation, or output. The theme explicitly removes WordPress emoji support via filters in `/inc/theme-supports.php`.

## Architecture

### Auto-loading System
`functions.php` recursively auto-loads all PHP files from `/inc/` directory. File organization:
- `/inc/` - Functional PHP code (classes, functions, hooks) - auto-loaded
- `/template-parts/` - Reusable template parts - loaded via `get_template_part()`
- `/sections/` - ACF flexible content section templates - loaded when section is rendered
- `/assets/` - Frontend assets (JS, SCSS, images, fonts)
- `/dist/` - Compiled assets (git-ignored, generated by Vite)

### Page Building with ACF Flexible Content
Pages use ACF Flexible Content fields called "Sections". Each section consists of:

1. **Layout Definition** - `/inc/acf/layouts/{section-name}.php`
   - Defines ACF field structure using `byrde_get_layout_{section_name}()` function
   - Returns array compatible with `acf_add_local_field_group()`

2. **Template Output** - `/sections/{section-name}.php`
   - Renders the section HTML using ACF field values
   - Access layout data via `get_sub_field()`

3. **Registration** - `/inc/acf/fields.php`
   - Imports all layout definitions
   - Registers flexible content field group with all layouts

Current available sections: hero, highlight-testimonials, services, faq, cta-section, areas-we-serve, testimonials.

**To add a new section:**
1. Create `/inc/acf/layouts/new-section.php` with function `byrde_get_layout_new_section()`
2. Create `/sections/new-section.php` template
3. Import in `/inc/acf/fields.php`: `require_once __DIR__ . '/layouts/new-section.php';`
4. Add to layouts array: `'layout_new_section' => byrde_get_layout_new_section()`

### Theme Settings (ACF Options Page)
Global settings managed via ACF in `/inc/acf/theme-settings.php`:
- Header configuration (logos, theme, Google reviews badge)
- Footer configuration (logo, social links, columns, privacy policy)
- Global contact buttons (reusable phone/CTA fields via `byrde_get_phone_fields()`)
- Theme colors (outputs CSS custom properties via `byrde_output_theme_css_variables()`)

Access with: `get_field('field_name', 'option')`

Color fields automatically generate CSS custom properties in `:root` including primary, secondary, alternative colors plus specific button, layout, text, and link colors.

### Tracking Settings (WordPress Settings API)
Tracking configuration is via **Settings > Tracking** in WordPress Admin (not ACF). Managed by `/inc/admin/tracking-settings.php`:
- Google Tag Manager ID (GTM-XXXXXXX) - Priority mode
- Google Analytics ID (G-XXXXXXXXXX or UA-XXXXXXXXX)
- Google Ads Conversion ID (AW-XXXXXXXXXX)
- Meta Pixel ID (15-16 digits)

IDs are stored as WordPress options and passed to JavaScript via `wp_localize_script` as `window.byrdeTracking` object in `/inc/enqueue.php`.

**Priority Logic**: If GTM ID is configured, only GTM loads. Otherwise, individual tracking codes load (legacy mode).

### Assets Pipeline (Vite)
Entry points:
- **JavaScript**: `/assets/js/load.js` → `/dist/main.min.js`
- **CSS**: `/assets/scss/load.scss` → `/dist/style.min.css`
- **Config**: `.config/vite.config.js`

JavaScript is organized in `/assets/js/components/`:
- `general/` - Core UI components (header, footer, animations, faq, hero)
- `tracking/` - Marketing tracking system
- `debug/` - Development debug utilities

Vite uses alias `@` pointing to `/assets/` for clean imports.

### SCSS Design System
Token-based design system with semantic functions. Never use hardcoded values.

**Colors:**
- Text: `text-color('primary')`, `text-color('secondary')`, `text-color('brand')`
- Buttons: `button-color('primary-bg')`, `button-color('secondary-hover')`
- Forms: `form-color('border-focus')`, `form-color('placeholder')`
- Backgrounds: `bg-color('primary')`, `bg-color('brand')`
- Borders: `border-color('primary')`

**Typography:**
- Families: `font-family('body')` (Nunito), `font-family('display')` (Lato)
- Sizes: `font-size('xs')` through `font-size('6xl')` - base is 'md' at 1.6rem
- Line Heights: `line-height('md')` - matches font-size keys

**Spacing:**
- `spacing('xs')` through `spacing('7xl')` for margin, padding, gap
- Base: `1rem = 10px` (html font-size at 62.5%)

**Border Radius:**
- `radius('sm')` through `radius('2xl')`, `radius('full')` for circles

**Responsive Mixins:**
- `@include max($mobile)` - 767px and below
- `@include min($tablet)` - 768px and above
- `@include between(768, 1024)` - tablet only

**Breakpoint Variables:**
- `$mobile: 767px`
- `$tablet: 768px`

Full documentation: `/assets/scss/README.md`

SCSS file structure:
- `/assets/scss/generic/` - Base system (variables, mixins, reset, grid, fonts)
- `/assets/scss/components/` - Reusable components (badges, buttons, forms, header, footer)
- `/assets/scss/sections/` - Section-specific styles matching `/sections/` templates

### Tracking System
Complete marketing tracking infrastructure in `/assets/js/components/tracking/`:

**Core Modules:**
- `tracking.js` - DataLayer management, base event tracking
- `utms.js` - UTM parameter capture and storage (localStorage + cookies)
- `ads.js` - Google Ads conversion tracking
- `capi.js` - Meta (Facebook) Pixel integration

**Initialization Flow** (in `/assets/js/load.js`):
1. Initialize core tracking and UTM capture
2. Check `window.byrdeTracking` for IDs
3. If GTM ID exists, load only GTM
4. Otherwise, load individual codes (GA, Google Ads, Meta Pixel)

All events push to `window.dataLayer` for GTM integration.

**Available Functions:**
- `pushEvent(event, data)` - Send custom event to dataLayer
- `trackPageView(pageData)` - Track page views
- `trackConversion(name, data)` - Generic conversion tracking
- `trackFormSubmit(formName, data)` - Form submissions
- `trackGoogleAdsLead(label, data)` - Google Ads lead tracking
- `trackMetaLead(data)` - Meta lead tracking

Full documentation: `/assets/js/components/tracking/README.md`

### Debug System
Located in `/assets/js/components/debug/`. Only active when:
- URL contains `?debug=true` AND
- User is logged in WordPress (body has `.logged-in` class)

**Methods:**
- `debug.log()` - Standard log
- `debug.success()` - Success message (green checkmark)
- `debug.warn()` - Warning (yellow)
- `debug.error()` - Error (red)
- `debug.group()` / `debug.groupEnd()` - Grouped logs
- `debug.table()` - Table display

Code is clean in production - no console output when debug is disabled.

### Typography and Icons
**Google Fonts:**
- Lato (400, 700, 900) - Headings
- Nunito (300, 400, 500, 600, 700) - Body text

**Material Symbols:**
- Used for star ratings in reviews
- Weight/fill configured in enqueue

**Phosphor Icons:**
- Local files in `/assets/fonts/phosphor-icons/`
- Three variants: Regular, Bold, Fill
- Usage:
  ```html
  <i class="ph ph-arrow-right"></i>         <!-- Regular -->
  <i class="ph-bold ph-arrow-right"></i>    <!-- Bold -->
  <i class="ph-fill ph-arrow-right"></i>    <!-- Fill -->
  ```

See `PHOSPHOR_ICONS.md` for common icons.

### Required Plugins
Theme uses TGM Plugin Activation (`/inc/admin/required-plugins.php`) to enforce required plugins:
- Site Kit by Google
- WP Activity Log
- Query Monitor

Configuration in `byrde_register_required_plugins()` function.

### Menus
Three registered menu locations (in `/inc/theme-supports.php`):
- `primary` - Primary Menu (header)
- `footer` - Footer Menu
- `footer_bottom` - Bottom Footer Menu

### File Upload Support
Enabled formats (in `/inc/theme-supports.php`):
- SVG images
- WebP images
- JSON files

## Template Parts
Reusable components in `/template-parts/components/`. Load via:
```php
get_template_part('template-parts/components/google-reviews-badge', null, [
    'variant' => 'google-reviews-badge--dark',
    'score' => '4.9',
    'reviews' => '127'
]);
```

## Utility Helpers
**ACF Utilities** in `/inc/acf/utils/`:
- `phone.php` - `byrde_get_phone_fields()` for reusable phone/CTA button fields
- `layout-settings.php` - Common layout settings (spacing, background, etc.)

## Cache Busting
Assets use theme version for cache busting. In development mode (`WP_DEBUG` true), uses `time()` for instant cache updates. See `/inc/enqueue.php`.

## Update System
Theme uses Plugin Update Checker for GitHub-based automatic updates. Configuration in `/inc/update-checker.php`. For private repositories, uncomment authentication line and add GitHub token with `repo` permission.

## Coding Standards
- PHP follows WordPress Coding Standards
- JavaScript uses ES6+ modules
- SCSS uses semantic token functions (never raw values)
- All tracking events automatically push to `window.dataLayer`
- No inline styles - use CSS custom properties from theme settings
- All code, comments, and documentation must be in English
